# ============================================
# Tmux Configuration
# ============================================
# Reference: https://builtin.com/articles/tmux-config

# ============================================
# General Settings
# ============================================

# Change default prefix from Ctrl+b to Ctrl+Space (consistent with neovim leader)
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# Enable mouse support for scrolling, clicking, and pane resizing
set -g mouse on

# Increase scrollback buffer size
set-option -g history-limit 5000

# Start window and pane numbering at 1 (not 0)
set -g base-index 1
setw -g pane-base-index 1

# Automatically renumber windows when one is closed
set -g renumber-windows on

# Enable true color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Reduce escape time for faster command sequences
set -sg escape-time 0

# ============================================
# Keybindings
# ============================================

# Quick config reload
bind r source-file ~/.tmux.conf \; display "Tmux config reloaded!"

# ============================================
# Window Management
# ============================================

# Create new window in current directory
bind c new-window -c "#{pane_current_path}"

# Toggle between current and previous window
bind Space last-window

# Toggle between current and previous session
bind-key C-Space switch-client -l

# Move windows left/right in the window list
bind -r "<" swap-window -d -t -1
bind -r ">" swap-window -d -t +1

# ============================================
# Pane Management
# ============================================

# More intuitive split commands (matching neovim conventions)
unbind %
unbind '"'
bind | split-window -h -c "#{pane_current_path}"
bind '\' split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"

# Vim-style pane resizing (using uppercase to avoid conflict with vim-tmux-navigator)
bind -r H resize-pane -L 15
bind -r J resize-pane -D 15
bind -r K resize-pane -U 15
bind -r L resize-pane -R 15

# Break pane into new window
bind b break-pane -d

# Join panes from other windows
bind C choose-window 'join-pane -h -s "%%"'
bind M choose-window 'join-pane -s "%%"'

# ============================================
# Marked Pane Navigation
# ============================================

# Mark current pane
bind m select-pane -m

# Jump to marked pane
bind ` switch-client -t'{marked}'

# ============================================
# Copy Mode (Vim-style)
# ============================================

# Use vim keybindings in copy mode
setw -g mode-keys vi

# Setup 'v' to begin selection in copy mode (like vim)
bind -T copy-mode-vi v send-keys -X begin-selection

# Setup 'y' to yank selection to system clipboard
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard"

# Setup 'C-v' for rectangle selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle

# ============================================
# Status Bar Customization
# ============================================

# Refresh status bar every 5 seconds
set -g status-interval 5

# Center window list
set -g status-justify centre

# Status bar colors
set -g status-style bg=default,fg=white

# Active window styling
setw -g window-status-current-style bg=blue,fg=black,bold

# Pane border colors
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=blue

# Status bar content - show hostname, date and time in 12-hour AM/PM format
set -g status-right-length 80
set -g status-right "#H  %a %b %e %l:%M %p"

# ============================================
# Additional Useful Bindings
# ============================================

# Kill pane without confirmation
bind x kill-pane

# Kill window without confirmation
bind X kill-window
bind e kill-window

# Synchronize panes (send commands to all panes in window)
bind S setw synchronize-panes

# ============================================
# Plugin Manager (TPM)
# ============================================
# To install TPM:
# git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# Then press prefix + I to install plugins

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'  # Seamless vim/tmux navigation

# Initialize TPM (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
